import React, { Component } from "react";
import "./Styles/List.css";

class List extends Component {
  constructor(props) {
    super(props);
    this.state = {
      selectOn: false, //Expand status of item filter
      selectedItemId: 113, //Item ID that is selected
    };
    this.showList = this.showList.bind(this);
    this.updateItem = this.updateItem.bind(this);
  }
  async componentDidMount() {
    const { getEachCategory, getCategories } = this.props;
    const { selectedItemId } = this.state;
    getCategories();
    getEachCategory(selectedItemId);
  }

  showList(param) {
    //set the expand status of item filter
    this.setState({ selectOn: param });
  }

  async updateItem(id) {
    //update the item category
    const { getEachCategory } = this.props;
    await this.setState({ selectedItemId: id });
    getEachCategory(id);
  }

  render() {
    const {
      filterList,
      selectedPrice,
      categories,
      getEachCategory,
    } = this.props;
    const { selectOn, selectedItemId } = this.state;
    return (
      <div className="main-list">
        <div className={`filter-div ${selectOn ? "add-size" : ""}`}>
          <div className="filter-title">Categories:</div>
          {categories.map((val, idx) => {
            const selected = parseInt(val.id) === selectedItemId; //check if this item is selected
            return (
              <React.Fragment>
                {selectOn ? (
                  <div
                    key={idx}
                    className={`filter-item ${selected ? "selected-item" : ""}`}
                    onClick={async () => {
                      await this.updateItem(val.id);
                      this.showList(false);
                    }}
                  >
                    {val.sub_category_name}
                  </div>
                ) : (
                  <React.Fragment>
                    {parseInt(val.id) === selectedItemId ? (
                      <div
                        key={idx}
                        className="filter-item selected-item"
                        onClick={() => this.showList(true)}
                      >
                        {val.sub_category_name}
                      </div>
                    ) : null}
                  </React.Fragment>
                )}
              </React.Fragment>
            );
          })}
        </div>
        <div className={`filter-div ${selectOn ? "add-size" : ""}`}>
          <div className="filter-title">Prices:</div>
          <div
            className={`filter-item ${
              selectedPrice === "0-50" ? "selected-item" : ""
            }`}
            onClick={async () => {
              await filterList("selectedPrice", "0-50");
              getEachCategory(selectedItemId);
            }}
          >
            {"0-50"}(USD)
          </div>
          <div
            className={`filter-item ${
              selectedPrice === "50-100" ? "selected-item" : ""
            }`}
            onClick={async () => {
              await filterList("selectedPrice", "50-100");
              getEachCategory(selectedItemId);
            }}
          >
            {"50-100"}(USD)
          </div>
        </div>
      </div>
    );
  }
}

export default List;
